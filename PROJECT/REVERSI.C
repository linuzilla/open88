/*  黑白棋程式 */

#include <stdio.h>
#include <stdlib.h>
#include <conio.h>
#include <dos.h>
#include <graphics.h>
#include <time.h>
#include <string.h>

#define BackGround (WHITE)
#define LineCOLOR  (GREEN)
#define CompCOLOR  (LIGHTRED)
#define UserCOLOR  (BLUE)
#define TextCOLOR  (BLACK)
#define CursCOLOR  (BLACK)
#define BoarCOLOR  (CYAN)


int  user_move(void);
int  comp_move(void);
void init_table(void);
void change(void);
int  check(int x, int y);
int  moveable(void);
void draw(int x, int y);
void comp_move_ini(void);
int  random_move(void);
void outcpattern(int x, int y, char *msg, int len, int xs, int ys);

struct _player {
     char *message;
     int  (*func)(void);
} player[2] = {
                 { "恭喜! 您贏了",  user_move },
                 { "抱歉! 您輸了", comp_move }
              };

struct _dir {
    int   x, y;
} dir[8] = {
        { -1, -1 }, {  0,  -1 }, {  1, -1 },
        { -1,  0 },              {  1,  0 },
        { -1,  1 }, {  0,   1 }, {  1,  1 }
           };

#define NUM     (8)             /*  設定為 8x8 的棋盤 */

struct _dir priority[NUM*NUM];
int  prio[5];


int XX, YY;                     /*  棋盤的啟始位置 */
int turn = 1;
int width;
int d = 2, xx, yy;

int  table[NUM+2][NUM+2];       /*  棋盤的陣列 */

char msg1[]    = {
                        /* 恭 */
                0x02,0x01,0x00,
                0x03,0x81,0xc0,
                0x03,0x01,0x98,
                0x7f,0xff,0xfc,
                0x03,0x01,0x80,
                0x03,0x01,0x80,
                0x03,0x01,0x80,
                0x03,0x01,0x86,
                0xff,0xff,0xff,
                0x01,0x81,0x00,
                0x03,0x00,0x80,
                0x06,0x20,0x40,
                0x0c,0x38,0x30,
                0x18,0x30,0x1c,
                0x64,0x30,0x0f,
                0x87,0x34,0x04,
                0x06,0x32,0x20,
                0x0c,0x33,0x10,
                0x0c,0x31,0x18,
                0x18,0x31,0x8c,
                0x30,0x31,0x8c,
                0x40,0x31,0x8c,
                0x03,0xf0,0x00,
                0x00,0x60,0x00,

                        /* 喜 */
                0x00,0x1c,0x00,
                0x00,0x18,0x0c,
                0x7f,0xff,0xfe,
                0x00,0x18,0x00,
                0x00,0x18,0x30,
                0x1f,0xff,0xf8,
                0x00,0x00,0x00,
                0x08,0x00,0x30,
                0x0f,0xff,0xf8,
                0x0c,0x00,0x30,
                0x0c,0x00,0x30,
                0x0f,0xff,0xf0,
                0x0a,0x00,0xc0,
                0x01,0x00,0x80,
                0x01,0x81,0x06,
                0xff,0xff,0xff,
                0x00,0x00,0x00,
                0x08,0x00,0x30,
                0x0f,0xff,0xf8,
                0x0c,0x00,0x30,
                0x0c,0x00,0x30,
                0x0c,0x00,0x30,
                0x0f,0xff,0xf0,
                0x08,0x00,0x20,

                        /* !  */
                0x00,0x00,0x00,
                0x02,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x02,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x02,0x00,0x00,
                0x00,0x00,0x00,

                        /* 您 */
                0x04,0x10,0x00,
                0x07,0x1c,0x00,
                0x0e,0x38,0x06,
                0x0c,0x3f,0xff,
                0x18,0x61,0x86,
                0x18,0xc1,0x84,
                0x3d,0x01,0x88,
                0x6c,0x09,0xa0,
                0x4c,0x1d,0x90,
                0x8c,0x19,0x98,
                0x0c,0x31,0x8c,
                0x0c,0xc1,0x86,
                0x0d,0x0f,0x86,
                0x08,0x03,0x00,
                0x00,0x20,0x00,
                0x02,0x18,0x00,
                0x13,0x8c,0x08,
                0x13,0x06,0x44,
                0x33,0x06,0x46,
                0x33,0x00,0x43,
                0x73,0x00,0x63,
                0x63,0xff,0xe3,
                0x61,0xff,0xc0,
                0x00,0x00,0x00,

                        /* 贏 */
                0x00,0x18,0x00,
                0x00,0x0c,0x06,
                0xff,0xff,0xff,
                0x0c,0x00,0x00,
                0x0c,0x00,0x00,
                0x07,0xff,0xf8,
                0x10,0x00,0x00,
                0x1f,0xff,0xf8,
                0x18,0x00,0x18,
                0x18,0x00,0x18,
                0x1f,0xff,0xf8,
                0x00,0x00,0x04,
                0x46,0x46,0xfe,
                0x7f,0x7f,0x4c,
                0x66,0x66,0x4c,
                0x76,0x7e,0xcc,
                0x6e,0x66,0x6c,
                0x66,0x7e,0x7c,
                0x6e,0x66,0x5c,
                0x76,0x7e,0x4d,
                0x66,0x20,0x4d,
                0x46,0x74,0x85,
                0x5e,0xc2,0x87,
                0x85,0x03,0x03,

                        /* 了 */
                0x00,0x00,0x00,
                0x00,0x00,0x18,
                0x3f,0xff,0xfc,
                0x00,0x00,0x18,
                0x00,0x00,0x30,
                0x00,0x00,0x60,
                0x00,0x00,0xc0,
                0x00,0x03,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x03,0xfc,0x00,
                0x00,0x38,0x00,
                        };
char msg2[]    = {
                        /* 抱 */
                0x08,0x08,0x00,
                0x0e,0x0e,0x00,
                0x0c,0x0c,0x00,
                0x0c,0x0c,0x06,
                0x0c,0x1f,0xff,
                0x0d,0x18,0x06,
                0xff,0xb0,0x06,
                0x0c,0x40,0x66,
                0x0c,0x9f,0xf6,
                0x0c,0x18,0x66,
                0x0c,0x18,0x66,
                0x0d,0x98,0x66,
                0x1f,0x18,0x66,
                0xfc,0x1f,0xe6,
                0x6c,0x18,0x46,
                0x0c,0x18,0x3c,
                0x0c,0x18,0x08,
                0x0c,0x18,0x02,
                0x0c,0x18,0x02,
                0x0c,0x18,0x02,
                0x0c,0x18,0x03,
                0x0c,0x1f,0xff,
                0x7c,0x0f,0xfe,
                0x18,0x00,0x00,

                        /* 歉 */
                0x20,0x70,0x80,
                0x18,0x60,0xe0,
                0x0c,0xc0,0xc0,
                0x08,0x88,0xc0,
                0xff,0xfc,0xc0,
                0x19,0x81,0x86,
                0x19,0x81,0xff,
                0x7f,0xfb,0x66,
                0x19,0x9a,0x64,
                0x19,0x9c,0x68,
                0x19,0x98,0x60,
                0xff,0xfe,0x60,
                0x19,0x98,0x60,
                0x19,0x98,0x60,
                0x19,0x98,0x60,
                0x7f,0xf8,0xf0,
                0x19,0x90,0xd0,
                0x39,0xc0,0xd0,
                0x39,0xb1,0x98,
                0x59,0x99,0x88,
                0x59,0x8b,0x0c,
                0x99,0x82,0x06,
                0x19,0x84,0x07,
                0x11,0x08,0x02,

                        /* !  */
                0x00,0x00,0x00,
                0x02,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x02,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x02,0x00,0x00,
                0x07,0x00,0x00,
                0x07,0x00,0x00,
                0x02,0x00,0x00,
                0x00,0x00,0x00,

                        /* 您 */
                0x04,0x10,0x00,
                0x07,0x1c,0x00,
                0x0e,0x38,0x06,
                0x0c,0x3f,0xff,
                0x18,0x61,0x86,
                0x18,0xc1,0x84,
                0x3d,0x01,0x88,
                0x6c,0x09,0xa0,
                0x4c,0x1d,0x90,
                0x8c,0x19,0x98,
                0x0c,0x31,0x8c,
                0x0c,0xc1,0x86,
                0x0d,0x0f,0x86,
                0x08,0x03,0x00,
                0x00,0x20,0x00,
                0x02,0x18,0x00,
                0x13,0x8c,0x08,
                0x13,0x06,0x44,
                0x33,0x06,0x46,
                0x33,0x00,0x43,
                0x73,0x00,0x63,
                0x63,0xff,0xe3,
                0x61,0xff,0xc0,
                0x00,0x00,0x00,

                        /* 輸 */
                0x10,0x01,0xc0,
                0x1c,0x01,0x80,
                0x19,0x03,0x40,
                0xff,0x86,0x20,
                0x18,0x0c,0x18,
                0x18,0x18,0x0c,
                0xff,0x20,0x07,
                0x99,0x4f,0xf2,
                0x99,0x00,0x00,
                0x99,0x23,0x04,
                0xff,0x3f,0xa7,
                0x99,0x33,0x36,
                0x99,0x33,0x26,
                0x99,0x33,0x26,
                0xff,0x3f,0x26,
                0x99,0x33,0x26,
                0x18,0x33,0x26,
                0x19,0x33,0x26,
                0xff,0xbf,0x26,
                0x18,0x33,0x26,
                0x18,0x33,0x06,
                0x18,0x63,0x06,
                0x18,0x47,0x3e,
                0x18,0x82,0x0c,

                        /* 了 */
                0x00,0x00,0x00,
                0x00,0x00,0x18,
                0x3f,0xff,0xfc,
                0x00,0x00,0x18,
                0x00,0x00,0x30,
                0x00,0x00,0x60,
                0x00,0x00,0xc0,
                0x00,0x03,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x00,0x0c,0x00,
                0x03,0xfc,0x00,
                0x00,0x38,0x00
                };

char msg0[]    = {
                        /*    */
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                        /* 平 */
                0x00,0x00,0x00,
                0x00,0x00,0x18,
                0x3f,0xff,0xfc,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x10,0x18,0x10,
                0x0c,0x18,0x1c,
                0x06,0x18,0x38,
                0x06,0x18,0x30,
                0x03,0x18,0x60,
                0x03,0x18,0x40,
                0x03,0x18,0x80,
                0x00,0x19,0x00,
                0x00,0x18,0x06,
                0xff,0xff,0xff,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x10,0x00,

                        /*    */
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,

                        /*    */
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,

                        /* 手 */
                0x00,0x00,0x70,
                0x00,0x03,0xf8,
                0x00,0x7f,0x00,
                0x3f,0xf8,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x18,
                0x3f,0xff,0xfc,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x04,
                0x00,0x18,0x0e,
                0xff,0xff,0xff,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x00,0x18,0x00,
                0x07,0xf8,0x00,
                0x00,0x70,0x00,

                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00,
                0x00,0x00,0x00
                };

main()          /*    主程式   */
{
    int     gdriver = DETECT, gmode, errorcode;
    int     i, x, y, pass, n[3];
    int     xmax, ymax;
    int     demo = 0;
    char    string[10];

#ifdef BGI
    registerbgidriver(EGAVGA_driver);
#endif

    initgraph(&gdriver, &gmode, "");    /*  啟動 Turbo C 的繪圖模式 */
    if ((errorcode = graphresult()) != grOk) {
        printf("Graphics error: %s\n", grapherrormsg(errorcode));
        return 1;
    }

    randomize();

    x = ((xmax = getmaxx()) - 50) / NUM;
    y = ((ymax = getmaxy()) - 50) / NUM;
    width = x < y ? x : y;
    XX    = (xmax - NUM * width) / 2;
    YY    = (ymax - NUM * width) / 2;

    do {
        if (demo) delay(1000);

        cleardevice();
        setfillstyle(SOLID_FILL, BackGround);
        bar(0, 0, xmax, ymax);

        init_table();           /*  新局，將棋盤初始化 */
        comp_move_ini();
        do {
            turn = (turn+1) % 2;        /* 換下一家 */
            if (moveable()) {           /* 檢查是否有路走 */
                if (player[turn].func())
                    break;
                change();               /* 將受影響的棋子變色 */
                pass = 0;               /* 設定旗號 */
            } else {
                pass++;                 /* 無路可走只好 pass 了 */
            }
        } while (pass < 2);             /* 若連續兩家都 pass 就結束 */

        for (n[0] = n[1] = n[2] = 0, x = 1; x <= NUM; x++)
            for (y = 1; y <= NUM; y++)
                n[table[x][y]]++;               /* 計算兩家的椇子數 */
        for (i = 1; i <= xmax/2/3-20; i++) {
            setfillstyle(SOLID_FILL, BoarCOLOR);
            bar(xmax/2 - i*3, ymax/2 - i, xmax/2 + i*3, ymax/2 + i);
        }
        sprintf(string, "%d : %d", n[1], n[2]);
        setcolor(TextCOLOR);
        settextstyle(DEFAULT_FONT, HORIZ_DIR, 7);
        outtextxy(XX+240-strlen(string)*30, YY+width+ 90, string);


        outcpattern(XX+10, YY+width+150,
               n[1] == n[2] ? msg0 : (n[1] > n[2] ? msg1 : msg2), 6, 3, 3);

        if (kbhit()) {
            switch(getch()) {
            case 'c' :
            case 'C' :
                demo = 0;
                player[0].func = comp_move;
                break;
            case 'r' :
            case 'R' :
                demo = 0;
                player[0].func = random_move;
                break;
            case 'd' :
            case 'D' :
                player[0].func = comp_move;
                demo = 1;
                break;
            default  :
                demo = 0;
                player[0].func = user_move;
            }
        }
    } while (demo || getch() != 27);

    closegraph();
    return 0;
}

void init_table()
{
    int  i, j;

    setfillstyle(SOLID_FILL, LineCOLOR);

    for (i = 0; i <= NUM; i++) {
        bar(XX+i*width-d, YY+d        , XX+i*width+d, YY+NUM*width-d);
        bar(XX+d        , YY+i*width-d, XX+NUM*width-d, YY+i*width+d);
    }

    for (i = 0; i < NUM + 2; i++)
        for (j = 0; j < NUM + 2; j++)
            table[i][j] = 0;

    xx = yy = NUM/2;
    table[xx][yy] = table[xx+1][yy+1] = 1;
    table[xx][yy+1] = table[xx+1][yy] = 2;

    draw(xx,   yy  );
    draw(xx,   yy+1);
    draw(xx+1, yy  );
    draw(xx+1, yy+1);
}

void comp_move_ini()
{
    int   i, j, k;
    int   x, y;

    prio[0] = 0;

    priority[0].x = priority[0].y = priority[1].x = priority[2].y = 1;
    priority[1].y = priority[2].x = priority[3].x = priority[3].y = NUM;

    prio[1] = 4;

    for (i = 3, k = 4; i <= NUM-2; i++) {
        priority[k].x = i;
        priority[k].y = 1;
        k++;
        priority[k].x = i;
        priority[k].y = NUM;
        k++;
        priority[k].x = 1;
        priority[k].y = i;
        k++;
        priority[k].x = NUM;
        priority[k].y = i;
        k++;
    }
    prio[2] = k;

    for (i = 3; i <= NUM-2; i++) {
        for (j = 3; j <= NUM-2; j++, k++) {
            priority[k].x = i;
            priority[k].y = j;
        }
    }
    prio[3] = k;

    for (i = 3; i <= NUM-2; i++) {
        priority[k].x = i;
        priority[k].y = 2;
        k++;
        priority[k].x = i;
        priority[k].y = NUM-1;
        k++;
        priority[k].x = 2;
        priority[k].y = i;
        k++;
        priority[k].x = NUM-1;
        priority[k].y = i;
        k++;
    }

    prio[4] = k;

    for (i = 1; i <= 4; i++) {
        for (j = prio[i]-1; j > prio[i-1]; j--) {
            k = random(j - prio[i-1]) + prio[i-1];
            x = priority[j].x;
            y = priority[j].y;
            priority[j].x = priority[k].x;
            priority[j].y = priority[k].y;
            priority[k].x = x;
            priority[k].y = y;
        }
    }
}

int user_move()
{
    int   k;
    int   x = xx - 1, y = yy -1;

    setlinestyle(SOLID_LINE, 1, THICK_WIDTH);
    do {
         while (! kbhit()) {
             setcolor(CursCOLOR);
             rectangle(XX+x*width+d+2,       YY+y*width+d+2,
                       XX+x*width+width-d-2, YY+y*width+width-d-2);
             delay(30);
             setcolor(BackGround);
             rectangle(XX+x*width+d+2,       YY+y*width+d+2,
                       XX+x*width+width-d-2, YY+y*width+width-d-2);
             delay(30);
         }
         switch(k = getch()) {
         case 72:  /* up    */
             y = (y + NUM - 1) % NUM;
             break;
         case 80:  /* down  */
             y = (y + 1) % NUM;
             break;
         case 75:  /* left  */
             x = (x + NUM - 1) % NUM;
             break;
         case 77:  /* right */
             x = (x + 1) % NUM;
             break;
         case '\r' :
         case ' '  :
             xx = x + 1;
             yy = y + 1;
             if (table[xx][yy] == 0 && check(xx, yy)) {
                  table[xx][yy] = turn+1;
                  draw(xx, yy);
                  k = ' ';
             } else {
                  sound(40);
                  delay(150);
                  nosound();
                  k = 0;
             }
             break;
         case 27  :
             return 1;
         }
    } while (k != ' ');

    return 0;
}

int comp_move()
{
    int  i, j;

    for (i = prio[0]; i < prio[4]; i++) {
        xx = priority[i].x;
        yy = priority[i].y;
        if (table[xx][yy] == 0 && check(xx, yy)) {
            if (i < prio[1]) {
                for (j = prio[4]-1; j >= prio[1]; j--) {
                    priority[j+3].x = priority[j].x;
                    priority[j+3].y = priority[j].y;
                }
                prio[4] += 3;
                priority[prio[1]+1].x = xx;
                priority[prio[1]+0].y = yy;
                priority[prio[1]+0].x = priority[prio[1]+2].x
                                      = xx == 1 ? xx + 1 : xx - 1;
                priority[prio[1]+1].y = priority[prio[1]+2].y
                                      = yy == 1 ? yy + 1 : yy - 1;
            }
            table[xx][yy] = turn+1;
            draw(xx, yy);
            return 0;
        }
    }

    return random_move();
}

int random_move()
{
    do {
        xx = random(NUM) + 1;
        yy = random(NUM) + 1;
    } while(table[xx][yy] != 0 || ! check(xx, yy));

    table[xx][yy] = turn+1;
    draw(xx, yy);
    return 0;
}

void change()
{
    int   i, j, k;

    for (i = 0; i < 8; i++) {
        for (j = 1; table[xx+j*dir[i].x][yy+j*dir[i].y] == 2 - turn; j++)
            ;
        if (table[xx+j*dir[i].x][yy+j*dir[i].y] == turn + 1)
            for (k = 1; k < j; k++) {
                table[xx+k*dir[i].x][yy+k*dir[i].y] = turn + 1;
                draw(xx+k*dir[i].x, yy+k*dir[i].y);
            }
    }
}

int check(int x, int y)
{
    int   i, j;

    for (i = 0; i < 8; i++) {
        for (j = 1; table[x+j*dir[i].x][y+j*dir[i].y] == 2 - turn; j++)
            ;
        if (j != 1 && table[x+j*dir[i].x][y+j*dir[i].y] == turn + 1)
            return 1;
    }
    return 0;
}

int moveable()
{
    int  i, j;

    for (i = 1; i <= NUM; i++)
        for (j = 1; j <= NUM; j++)
            if (table[i][j] == 0 && check(i, j))
                return 1;
    return 0;
}

void draw(int x, int y)
{
    if (table[x][y]) {
        setcolor(BackGround);
        setfillstyle(SOLID_FILL, table[x][y]==1 ? UserCOLOR : CompCOLOR);
        fillellipse(XX+(x-1)*width+d+(width-d)/2,
                    YY+(y-1)*width+d+(width-d)/2,
                    (width-d)/2-3, (width-d)/2-3);
    }
}

void outcpattern(int x, int y, char *msg, int len, int xs, int ys)
{
    int  i, j, k, js, ks, m;
    char c;

    for (i = 0; i < len; i++) {
        for (j = 0; j < 24; j++) {
            for (js = 0; js < ys; js++) {
                for (k = 0; k < 3; k++) {
                    for (m = 0, c = *(msg+(i*24+j)*3+k); m < 8; m++) {
                        if (((c >> (7-m)) & 0x01) != 0) {
                            for (ks = 0; ks < xs; ks++) {
                                putpixel(x+(24*i+k*8+m)*xs+ks, y+j*ys+js, getcolor());
                            }
                        }
                    }
                }
            }
        }
    }
}
